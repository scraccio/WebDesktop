<!DOCTYPE html>
<html>

<head>
	<title>Esercizio 7</title>
	<link rel="stylesheet" type="text/css"
		href="http://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">
	<style>
		@import url('https://fonts.googleapis.com/css?family=Ubuntu+Mono');
		@import url('https://fonts.googleapis.com/css?family=Ubuntu');

		html,
		body {
			color: white;
			font-family: "Ubuntu";
			background: rgb(64, 219, 226);
			background: linear-gradient(25deg, rgb(50, 174, 211) 0%, rgb(31, 1, 92) 100%);
			overflow: hidden;
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
		}

		.container {
			width: 50%;
			height: 55%;
			position: absolute;
			left: 20%;
			top: 20%;
			box-shadow: 3px 3px 10px rgb(14, 14, 14);
			border-top-right-radius: 5px;
			border-top-left-radius: 5px;
			border-bottom-right-radius: 1%;
			border-bottom-left-radius: 1%;
		}

		.transitions{
			transition: all 0.2s;
		}

		#containerDesktop {
			display: flex;
			width: 100%;
			height: calc(100% - 50px);
			flex-direction: row;
			-webkit-user-drag: none;
		}

		.menu,
		.fishyMenu {
			border: 1px;
			background: rgb(255, 255, 255);
			background: linear-gradient(0deg, rgb(60, 60, 55) 0%, rgb(79, 78, 73) 100%);
			border-top-right-radius: 5px;
			border-top-left-radius: 5px;
			cursor: move;
			height: 35px;
			width: 100%;
			position: sticky;
			padding: 7px;
			user-select: none;
			box-sizing: border-box;
		}

		.button {
			width: 17px;
			height: 17px;
			vertical-align: middle;
			border-radius: 10px;
			cursor: pointer;
			position: relative;
			border: 1px solid rgb(55, 55, 55);
		}

		.menuEntry1 {
			background: linear-gradient(0deg, rgb(223, 80, 30) 0%, rgb(242, 133, 100) 100%);
			margin-left: 3px;
			text-align: center;
			color: rgb(68, 68, 68);
			display: inline-block;
		}

		.menuEntry1:hover {
			background: linear-gradient(0deg, rgb(200, 60, 10) 0%, rgb(242, 111, 71) 100%);
		}

		.menuCross {
			position: absolute;
			font-size: 10px;
			font-weight: bolder;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
		}

		.menuEntry2,
		.menuEntry3 {
			background: linear-gradient(0deg, rgb(90, 90, 90) 0%, rgb(132, 132, 132) 100%);
			color: rgb(68, 68, 68);
			display: inline-block;
		}

		.menuEntry2:hover,
		.menuEntry3:hover {
			background: linear-gradient(0deg, rgb(70, 70, 70) 0%, rgb(122, 122, 122) 100%);
		}

		.menuMinimize {
			position: absolute;
			font-size: 12px;
			left: 50%;
			top: 53%;
			transform: translate(-50%, -50%);
		}

		.menuMaximize {
			position: absolute;
			font-size: 18px;
			left: 49%;
			top: 50%;
			transform: translate(-50%, -50%);
		}

		.menuEntry4 {
			margin-bottom: 2px;
			margin-left: 8px;
			border-radius: 10px;
			font-size: 15px;
			white-space: wrap;
			vertical-align: middle;
			display: inline-block;
		}

		.textField {
			width: 100%;
			height: calc(100% - 34px);
			position: absolute;
			top: 34px;
			overflow: auto;
			border-bottom-right-radius: 1%;
			border-bottom-left-radius: 1%;
			background-color: rgb(71, 26, 52);
			display: block;
			font-size: 16px;
			padding: 4px;
			box-sizing: border-box;
		}

		::selection {
			color: rgb(48, 19, 36);
			background: white;
		}

		#column1,
		#column2,
		#column3,
		#column4,
		#column5,
		#column6,
		#column7,
		#column8,
		#column9,
		#column10 {
			padding: 20px;
			display: flex;
			flex-direction: column;
			width: 100px;
			height: calc(100% - 70px);
		}

		.terminal-icon,
		.fishy-icon,
		.document-icon,
		.browser-icon {
			position: relative;
			left: 0;
			top: 0;
			margin: 10px;
			width: 100px;
			flex: 100px 0 0;
			aspect-ratio: 1/1;
			border-radius: 15px;
			margin-top: 10px;
			cursor: pointer;
			user-select: none;
		}

		.terminal-icon>img {
			width: 75%;
			height: 75%;
			border: 4px solid white;
			border-radius: 10px;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -58%);
			-webkit-user-drag: none;
			user-select: none;
			transition: 0.1s ease-out;
		}

		.fishy-icon>img {
			width: 75%;
			height: 75%;
			border-radius: 10px;
			border: 4px solid white;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -58%);
			-webkit-user-drag: none;
			user-select: none;
			transition: 0.1s ease-out;
		}

		.document-icon>img {
			width: 75%;
			height: 75%;
			border: 4px solid white;
			border-radius: 10px;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -58%);
			-webkit-user-drag: none;
			user-select: none;
			transition: 0.2s ease-out;
		}

		.browser-icon>img {
			width: 75%;
			height: 75%;
			border: 4px solid white;
			border-radius: 10px;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -58%);
			-webkit-user-drag: none;
			user-select: none;
			transition: 0.2s ease-out;
		}

		.terminal-icon>img:hover,
		.fishy-icon>img:hover,
		.document-icon>img:hover,
		.browser-icon>img:hover {
			width: 80%;
			height: 80%;
			transition: 0.2s ease-out;
		}

		.bottom-bar {
			width: 100%;
			height: 50px;
			background-color: rgb(2, 0, 46);
			position: absolute;
			bottom: 0;
			z-index: 2;
			user-select: none;
		}

		.bottom-bar-element {
			background-color: rgb(2, 0, 46);
			user-select: none;
		}

		.bottom-bar-element:hover {
			background-color: rgb(5, 0, 80);
		}

		.icon-text {
			position: absolute;
			bottom: -5px;
			left: 50%;
			transform: translateX(-50%);
			font-size: 13px;
		}

		.start-button {
			position: relative;
			display: inline-block;
			width: 50px;
			height: 100%;
			background-color: rgb(2, 0, 46);
		}

		#flagtopleft,
		#flagtopright,
		#flagbottomleft,
		#flagbottomright {
			position: absolute;
			width: 9px;
			height: 9px;
			background-color: white;
		}

		#flagtopleft {
			top: 15px;
			left: 15px;
		}

		#flagtopright {
			top: 15px;
			left: 26px;
		}

		#flagbottomleft {
			top: 26px;
			left: 15px;
		}

		#flagbottomright {
			top: 26px;
			left: 26px;
		}

		.start-button:hover {
			background-color: rgb(5, 0, 80);
		}

		.start-button:hover>#flagtopleft,
		.start-button:hover>#flagtopright,
		.start-button:hover>#flagbottomleft,
		.start-button:hover>#flagbottomright {
			background-color: yellow;
		}

		#firstText:hover,
		#secondText:hover,
		#thirdText:hover,
		#fourthText:hover,
		#blocco1:hover,
		#blocco2:hover,
		#blocco3:hover {
			background-color: rgb(220, 220, 220);
		}

		.textFieldDoc {
			width: 100%;
			height: calc(100% - 34px);
			position: absolute;
			top: 34px;
			overflow: auto;
			border-bottom-right-radius: 1%;
			border-bottom-left-radius: 1%;
			background-color: white;
			display: block;
			font-size: 16px;
			padding: 4px;
			box-sizing: border-box;
		}

		.textFieldDoc::selection,
		.textFieldDoc>div::selection {
			color: white;
			background: black;
		}

		@keyframes popup{
			0%{
				opacity: 0;
				transform: scale(0.5);
			}
			70%{
				opacity: 100%;
				transform: scale(1.1);
			}
			100%{
				opacity: 100%;
				transform: scale(1);
			}
		}

		@keyframes antiPopup{
			0%{
				opacity: 100%;
				transform: scale(1);
			}

			100%{
				opacity: 0;
				transform: scale(0.5);
			}
		}

		@keyframes popupProgram{
			0%{
				opacity: 0;
				transform: scale(0.8);
			}
			100%{
				opacity: 100%;
				transform: scale(1);
			}
		}

		@keyframes antiPopupProgram{
			0%{
				opacity: 100%;
				transform: scale(1);
			}
			100%{
				opacity: 0;
				transform: scale(0.8);
			}
		}

		.popup{
			animation: popup 0.1s linear forwards 1;
		}

		.antiPopup{
			animation: antiPopup 0.1s linear forwards 1;
		}

		.popupProgram{
			animation: popupProgram 0.08s linear forwards 1;
		}

		.antiPopupProgram{
			animation: antiPopupProgram 0.08s linear forwards 1;
		}

		.maximizeAnimation{
			width: 100%;
			height: 100%;
			left: 0;
			top: 0;
			transition: all 0.2s;
		}

	</style>
</head>

<body>
	<div id="containerDesktop">
		<div id="column1"></div>
		<div id="column2"></div>
		<div id="column3"></div>
		<div id="column4"></div>
		<div id="column5"></div>
		<div id="column6"></div>
		<div id="column7"></div>
		<div id="column8"></div>
		<div id="column9"></div>
		<div id="column10"></div>
	</div>



	<div class="bottom-bar" oncontextmenu="event.preventDefault();event.stopPropagation();">
		<div class="start-button">
			<div id="flagtopleft"></div>
			<div id="flagtopright"></div>
			<div id="flagbottomleft"></div>
			<div id="flagbottomright"></div>
		</div>
	</div>

	<script src="assets/js/document.js"></script>
	<script src="assets/js/fishy.js"></script>
	<script src="assets/js/browser.js"></script>
	<script src="assets/js/terminal.js"></script>
	<script src="assets/js/functions.js"></script>
	<script>

		let objArray = [];
		let terminalCount = 0;
		let fishyCount = 0;
		let documentCount = 0;
		let browserCount = 0;
		let clipboard;
		let ind;
		let currentColumn = 1;
		let currElementsCol = 0;
		let copied = false;
		let openTerminal = 0;
		let openFishy = 0;
		let openBrowser = 0;

		localStorage.setItem('terminalCount', 1);
		localStorage.setItem('fishyCount', 1);
		localStorage.setItem('documentCount', 1);
		localStorage.setItem('browserCount', 1);

		let fileArray = [];

		let browserHistory = [];

		let openIcon = new Image();
		let closeIcon = new Image();
		let deleteIcon = new Image();
		let renameIcon = new Image();
		let copyIcon = new Image();
		let pasteIcon = new Image();
		let newIcon = new Image();
		let terminalIcon = new Image();
		let fishyIcon = new Image();
		let documentIcon = new Image();
		let browserIcon = new Image();
		let terminalIconDesktop = new Image();
		let fishyIconDesktop = new Image();
		let documentIconDesktop = new Image();
		let browserIconDesktop = new Image();
		
		preloadImages();

		for (let i = 0; i < localStorage.length; i++) {
			if (localStorage.key(i).includes('document') && !localStorage.key(i).includes('Count')) {
				fileArray.push(parseInt(localStorage.key(i).slice(8)));
			}
		}
		fileArray = fileArray.sort(function (a, b) {return a - b;});


		for(let i=0; i<localStorage.length; i++){
			if(localStorage.key(i) == 'terminalCount'){
				for(let j=0; j<localStorage.getItem('terminalCount'); j++){
					createIcon('terminal', j);
					terminalCount++;
				}
			}
			if(localStorage.key(i) == 'fishyCount'){
				for(let j=0; j<localStorage.getItem('fishyCount'); j++){
					createIcon('fishy', j);
					fishyCount++;
				}
			}
			if(localStorage.key(i) == 'browserCount'){
				for(let j=0; j<localStorage.getItem('browserCount'); j++){
					createIcon('browser', j);
					browserCount++;
				}
			}
		}

		for (let i = 0; i < fileArray.length; i++) {
			newDocument(fileArray[i]);
		}

		document.addEventListener('contextmenu', (e) => {
			e.preventDefault();
			setTimeout(() => {
				removeActiveDivs();
				removeRename();

				let menu = document.createElement("div");
				document.body.appendChild(menu);

				var x = e.clientX;
				var y = e.clientY;

				menu.id = 'contextmenu';
				menu.style.position = "fixed";
				menu.style.left = x + 10 + "px";
				if (y >= window.innerHeight - 50) {
					menu.style.top = (y - 20) + "px";
				}
				else {
					menu.style.top = y + "px";
				}
				menu.style.width = '90px';
				menu.style.height = '22px';
				menu.style.backgroundColor = 'rgb(240, 240, 240)';
				menu.style.padding = '5px';
				menu.style.borderRadius = '5px';
				menu.style.zIndex = 3;
				menu.style.boxShadow = '3px 3px 10px rgb(14, 14, 14)';
				menu.className = 'popup';

				let firstText = document.createElement("div");
				firstText.id = 'firstText';
				firstText.onclick = (e) => {
					e.stopPropagation();
					let blocco = document.createElement('div');
					blocco.style.userSelect = 'none';
					blocco.style.width = '150px';
					blocco.style.height = '115px';
					blocco.id = 'blocco';
					blocco.style.position = 'absolute';
					blocco.style.padding = '5px';
					blocco.style.boxSizing = 'border-box';
					blocco.style.top = '-5px';
					blocco.style.left = '96px'
					//blocco.style.border = '1px solid black';
					blocco.style.backgroundColor = 'rgb(240, 240, 240)';
					blocco.style.color = 'rgb(75, 89, 94)';
					blocco.style.fontSize = '13px';
					blocco.style.borderRadius = '5px';
					blocco.style.boxShadow = '2px 2px 5px rgb(14, 14, 14)';
					blocco.className = 'popup';
					firstText.appendChild(blocco);

					let blocco1 = document.createElement('div');
					blocco1.id = 'blocco1';
					blocco1.style.position = 'relative';
					blocco1.style.top = 0;
					blocco1.style.left = 0;
					blocco1.style.marginTop = '2px';
					blocco1.style.marginBottom = '2px';
					blocco1.style.borderRadius = '5px';
					blocco1.appendChild(documentIcon);
					blocco1.innerHTML += 'Documento';
					//blocco1.innerHTML += '\xA0' + '<img src="assets/img/documentIcon.png" style="transform: scale(0.8);"/>' + '\xA0' + 'Documento';
					blocco1.style.display = 'flex';
					blocco1.style.alignItems = 'center';
					//blocco1.textContent = 'Documento';
					//blocco1.style.borderBottom = '1px solid rgb(50, 50, 50)';
					blocco1.onclick = () => {
						menu.classList.remove('popup');
						menu.classList.add('antiPopup');
						menu.addEventListener('transitionEnd', ()=>{
							menu.remove();
						})
						if (fileArray.length > 0) {
							newDocument(fileArray[fileArray.length - 1] + 1);
							fileArray[fileArray.length] = fileArray[fileArray.length - 1] + 1;
						}
						else {
							newDocument(documentCount);
						}

					}
					blocco.appendChild(blocco1);

					let blocco2 = document.createElement('div');
					blocco2.id = 'blocco2';
					blocco2.style.position = 'relative';
					blocco2.style.top = 0;
					blocco2.style.left = 0;
					blocco2.style.marginTop = '2px';
					blocco2.style.marginBottom = '2px';
					blocco2.style.borderRadius = '5px';
					blocco2.appendChild(terminalIcon);
					blocco2.innerHTML += 'Terminal';
					//blocco2.innerHTML += '\xA0' + '<img src="assets/img/terminalIcon.png" style="transform: scale(0.8);"/>' + '\xA0' + 'Terminale';
					blocco2.style.display = 'flex';
					blocco2.style.alignItems = 'center';
					//blocco2.textContent = 'Terminale' + '\xA0' + '\xA0' + '\xA0';
					blocco2.onclick = () => {
						createIcon('terminal', terminalCount);
						terminalCount++;
						localStorage.setItem('terminalCount', terminalCount);
						menu.classList.remove('popup');
						menu.classList.add('antiPopup');
						menu.addEventListener('transitionEnd', ()=>{
							menu.remove();
						})
					}
					blocco.appendChild(blocco2);

					let blocco3 = document.createElement('div');
					blocco3.id = 'blocco3';
					blocco3.style.position = 'relative';
					blocco3.style.top = 0;
					blocco3.style.left = 0;
					blocco3.style.marginTop = '2px';
					blocco3.style.marginBottom = '2px';
					blocco3.style.borderRadius = '5px';
					blocco3.appendChild(fishyIcon);
					blocco3.innerHTML += 'Fishy';
					//blocco3.innerHTML += '\xA0' + '<img src="assets/img/fishyIcon.png" style="transform: scale(0.8);"/>' + '\xA0' + 'Fishy';
					blocco3.style.display = 'flex';
					blocco3.style.alignItems = 'center';
					//blocco3.textContent = 'Fishy' + '\xA0' + '\xA0' + '\xA0';
					blocco3.onclick = () => {
						fishyCount++;
						createIcon('fishy', fishyCount);
						localStorage.setItem('fishyCount', fishyCount);
						menu.classList.remove('popup');
						menu.classList.add('antiPopup');
						menu.addEventListener('transitionEnd', ()=>{
							menu.remove();
						})
					}
					blocco.appendChild(blocco3);

					let blocco4 = document.createElement('div');
					blocco4.id = 'blocco3';
					blocco4.style.position = 'relative';
					blocco4.style.top = 0;
					blocco4.style.left = 0;
					blocco4.style.marginTop = '2px';
					blocco4.style.marginBottom = '2px';
					blocco4.style.borderRadius = '5px';
					blocco4.appendChild(browserIcon);
					blocco4.innerHTML += 'Browser';
					blocco4.style.display = 'flex';
					blocco4.style.alignItems = 'center';
					//blocco4.textContent = 'Browser' + '\xA0' + '\xA0' + '\xA0';
					blocco4.onclick = () => {
						createIcon('browser', browserCount);
						browserCount++;
						localStorage.setItem('browserCount', browserCount);
						menu.classList.remove('popup');
						menu.classList.add('antiPopup');
						menu.addEventListener('transitionEnd', ()=>{
							menu.remove();
						})
					}
					blocco.appendChild(blocco4);
				}
				firstText.style.position = 'relative';
				//firstText.innerHTML += '\x20';
				//firstText.textContent = '\xA0' + 'Nuovo' + '\xA0' + '\xA0' + '\xA0' + '\xA0' + ' â–¶';
				//firstText.innerHTML += '\xA0' + 'Nuovo' + '\xA0' + '\xA0' + '<img src="assets/img/newIcon.png" style="transform: scale(0.4);"/>';
				firstText.innerHTML += '\xA0' + 'Nuovo' + '\xA0' + '\xA0';
				firstText.appendChild(newIcon);
				
				firstText.style.color = 'rgb(75, 89, 94)';
				firstText.style.fontSize = '14px';
				firstText.style.fontFamily = 'Sans-Serif';
				firstText.style.fontWeight = '700';
				firstText.style.display = 'flex';
				firstText.style.alignItems = 'center';
				firstText.style.borderRadius = '5px';
				firstText.style.height = '22px';
				//firstText.style.borderBottom = '1px solid rgb(50, 50, 50)';
				firstText.style.cursor = 'default';
				menu.appendChild(firstText);

				if (copied) {
					menu.style.height = '56px';
					let secondText = document.createElement("div");
					secondText.id = 'secondText';
					secondText.onclick = () => {
						let c;
						if(clipboard == 'terminal'){
							c = terminalCount;
							createIcon(clipboard, c);
							terminalCount++;
						}
						if(clipboard == 'fishy'){
							c = fishyCount;
							createIcon(clipboard, c);
							fishyCount++;
						}
						if(clipboard == 'browser'){
							c = browserCount;
							createIcon(clipboard, c);
							browserCount++;
						}
						if(clipboard == 'document'){
							localStorage.setItem('document' + (documentCount), localStorage.getItem('document'+ind));
							if (fileArray.length > 0) {
								newDocument(fileArray[fileArray.length - 1] + 1);
								fileArray[fileArray.length] = fileArray[fileArray.length - 1] + 1;
								localStorage.setItem( 'document' + (fileArray[fileArray.length - 1] + 1).toString(), localStorage.getItem('document' + ind) );
							}
							else {
								newDocument(documentCount);
								localStorage.setItem('document' + documentCount.toString(), localStorage.getItem('document' + ind));
							}
						}

						clipboard = undefined;
						copied = false;
					}
					secondText.style.position = 'relative';
					secondText.appendChild(pasteIcon);
					secondText.innerHTML += 'Incolla';
					secondText.style.color = 'rgb(75, 89, 94)';
					secondText.style.fontSize = '14px';
					secondText.style.fontFamily = 'Sans-Serif';
					secondText.style.fontWeight = '700';
					secondText.style.display = 'flex';
					secondText.style.alignItems = 'center';
					secondText.style.marginTop = '2px';
					secondText.style.marginBottom = '2px';
					secondText.style.borderRadius = '5px';
					secondText.style.cursor = 'default';
					menu.appendChild(secondText);
				}

			}, 1);
		});

		document.addEventListener('click', () => {
			removeRename();
			if (document.getElementById('contextmenu')) {
				document.getElementById('contextmenu').classList.add('antiPopup');
				document.getElementById('contextmenu').classList.remove('popup');
				document.getElementById('contextmenu').addEventListener('transitionend', ()=>{
					document.getElementById('contextmenu').remove();
				})
			}
			if (document.getElementById('error')) {
				document.getElementById('error').classList.add('antiPopup');
				document.getElementById('error').classList.remove('popup');
				document.getElementById('error').addEventListener('transitionend', ()=>{
					document.getElementById('error').remove();
				});
			}
		});

	</script>
</body>

</html>